<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>tidyverse_workshop_summer2024 - Data Wrangling with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">tidyverse_workshop_summer2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#why-learn-r" id="toc-why-learn-r" class="nav-link" data-scroll-target="#why-learn-r">Why learn R?</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a></li>
  <li><a href="#starting-out-in-r" id="toc-starting-out-in-r" class="nav-link" data-scroll-target="#starting-out-in-r">Starting out in R</a>
  <ul class="collapse">
  <li><a href="#downloading-installing-and-running-r" id="toc-downloading-installing-and-running-r" class="nav-link" data-scroll-target="#downloading-installing-and-running-r">Downloading, Installing and Running R</a></li>
  <li><a href="#rstudio" id="toc-rstudio" class="nav-link" data-scroll-target="#rstudio">RStudio</a></li>
  </ul></li>
  <li><a href="#r-scripts" id="toc-r-scripts" class="nav-link" data-scroll-target="#r-scripts">R Scripts</a></li>
  <li><a href="#welcome-to-the-tidyverse" id="toc-welcome-to-the-tidyverse" class="nav-link" data-scroll-target="#welcome-to-the-tidyverse">Welcome to the Tidyverse</a></li>
  <li><a href="#what-is-tidy-data" id="toc-what-is-tidy-data" class="nav-link" data-scroll-target="#what-is-tidy-data">What is Tidy Data?</a></li>
  <li><a href="#installing-and-loading-packages" id="toc-installing-and-loading-packages" class="nav-link" data-scroll-target="#installing-and-loading-packages">Installing and loading packages</a></li>
  <li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data">Importing data</a></li>
  <li><a href="#exploring-and-summarizing-data" id="toc-exploring-and-summarizing-data" class="nav-link" data-scroll-target="#exploring-and-summarizing-data">Exploring and Summarizing data</a>
  <ul class="collapse">
  <li><a href="#data-frames" id="toc-data-frames" class="nav-link" data-scroll-target="#data-frames">Data Frames</a></li>
  <li><a href="#base-r-functions-for-exploring-data" id="toc-base-r-functions-for-exploring-data" class="nav-link" data-scroll-target="#base-r-functions-for-exploring-data">Base R functions for exploring data</a></li>
  <li><a href="#tidyverse-functions-for-exploring-data" id="toc-tidyverse-functions-for-exploring-data" class="nav-link" data-scroll-target="#tidyverse-functions-for-exploring-data"><strong><code>tidyverse</code></strong> functions for exploring data</a></li>
  </ul></li>
  <li><a href="#subsetting-data-with-select-and-filter" id="toc-subsetting-data-with-select-and-filter" class="nav-link" data-scroll-target="#subsetting-data-with-select-and-filter">Subsetting data with <code>select()</code> and <code>filter()</code></a></li>
  <li><a href="#changing-and-creating-variables-with-mutate" id="toc-changing-and-creating-variables-with-mutate" class="nav-link" data-scroll-target="#changing-and-creating-variables-with-mutate">Changing and creating variables with <code>mutate()</code></a></li>
  <li><a href="#grouping-and-summarizing" id="toc-grouping-and-summarizing" class="nav-link" data-scroll-target="#grouping-and-summarizing">Grouping and Summarizing</a></li>
  <li><a href="#visualizing-data-with-ggplot2" id="toc-visualizing-data-with-ggplot2" class="nav-link" data-scroll-target="#visualizing-data-with-ggplot2">Visualizing Data with ggplot2</a>
  <ul class="collapse">
  <li><a href="#setting-vs-mapping-aesthetics" id="toc-setting-vs-mapping-aesthetics" class="nav-link" data-scroll-target="#setting-vs-mapping-aesthetics">Setting vs mapping aesthetics</a></li>
  <li><a href="#building-a-grouped-bar-chart" id="toc-building-a-grouped-bar-chart" class="nav-link" data-scroll-target="#building-a-grouped-bar-chart">Building a grouped bar chart</a></li>
  <li><a href="#adding-titles-and-axis-labels" id="toc-adding-titles-and-axis-labels" class="nav-link" data-scroll-target="#adding-titles-and-axis-labels">Adding titles and axis labels</a></li>
  <li><a href="#working-with-color-palettes" id="toc-working-with-color-palettes" class="nav-link" data-scroll-target="#working-with-color-palettes">Working with color palettes</a></li>
  <li><a href="#changing-the-theme" id="toc-changing-the-theme" class="nav-link" data-scroll-target="#changing-the-theme">Changing the theme</a></li>
  </ul></li>
  <li><a href="#joining-datasets" id="toc-joining-datasets" class="nav-link" data-scroll-target="#joining-datasets">Joining datasets</a></li>
  <li><a href="#next-steps-from-beginnr-to-practitionr" id="toc-next-steps-from-beginnr-to-practitionr" class="nav-link" data-scroll-target="#next-steps-from-beginnr-to-practitionr">Next Steps: From BeginnR to PractitionR</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Wrangling with R</h1>
<p class="subtitle lead">An Introduction to the Tidyverse</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>By the end of this session, students will be able to:</p>
<ul>
<li>Explain some benefits of learning R</li>
<li>Navigate RStudio</li>
<li>Identify sources of documentation about R packages and functions</li>
<li>Apply commonly used <strong><code>tidyverse</code></strong> functions to a real data set</li>
</ul>
</section>
<section id="why-learn-r" class="level2">
<h2 class="anchored" data-anchor-id="why-learn-r">Why learn R?</h2>
<ul>
<li><p><strong>R is free, open-source, and cross-platform.</strong> Anyone can inspect the source code to see how R works. Because of this transparency, there is less chance for mistakes, and if you (or someone else) find some, you can report and fix bugs. Because R is open source and is supported by a large community of developers and users, there is a very large selection of third-party add-on packages which are freely available to extend R’s native capabilities.</p></li>
<li><p><strong>R code is great for reproducibility</strong>. Reproducibility is when someone else (including your future self) can obtain the same results from the same dataset when using the same analysis. R integrates with other tools to generate manuscripts from your code. If you collect more data, or fix a mistake in your dataset, the figures and the statistical tests in your manuscript are updated automatically.</p></li>
<li><p><strong>R relies on a series of written commands, not on remembering a succession of pointing and clicking.</strong> If you want to redo your analysis because you collected more data, you don’t have to remember which button you clicked in which order to obtain your results; you just have to run your script again.</p></li>
<li><p><strong>R is interdisciplinary and extensible</strong> With 10,000+ packages that can be installed to extend its capabilities, R provides a framework that allows you to combine statistical approaches from many scientific disciplines to best suit the analytical framework you need to analyze your data. For instance, R has packages for image analysis, GIS, time series, population genetics, and a lot more.</p></li>
<li><p><strong>R works on data of all shapes and sizes.</strong> The skills you learn with R scale easily with the size of your dataset. Whether your dataset has hundreds or millions of lines, it won’t make much difference to you. R is designed for data analysis. It comes with special data structures and data types that make handling of missing data and statistical factors convenient. R can connect to spreadsheets, databases, and many other data formats, on your computer or on the web.</p></li>
<li><p><strong>R produces high-quality graphics.</strong> The plotting functionalities in R are endless, and allow you to adjust any aspect of your graph to convey most effectively the message from your data.</p></li>
<li><p><strong>R has a large and welcoming community.</strong> Thousands of people use R daily. Many of them are willing to help you through mailing lists and websites such as <a href="https://stackoverflow.com/">Stack Overflow</a>, or on the <a href="https://community.rstudio.com/">RStudio community</a>. Questions which are backed up with <a href="https://www.tidyverse.org/help/">short, reproducible code snippets</a> are more likely to attract knowledgeable responses.</p></li>
</ul>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>For this lesson we will be using data which comes from <a href="https://www.tycho.pitt.edu/">Project Tycho</a> - an open data project from the University of Pittsburgh which provides standardized datasets on numerous diseases to aid global health research.</p>
<p>Throughout this lesson, we will be using a dataset from Project Tycho featuring historical counts of measles cases in the U.S.. We want to clean and present this data in a way that makes it easy to see how measles cases fluctuated over time.</p>
<p>A useful feature of Project Tycho data is their use of a common set of variables. Read more about their <a href="&quot;https://www.tycho.pitt.edu/dataformat/ProjectTychoPreCompiledDataFormat.pdf&quot;">data format</a>.</p>
</section>
<section id="starting-out-in-r" class="level2">
<h2 class="anchored" data-anchor-id="starting-out-in-r">Starting out in R</h2>
<p><a href="https://cran.rstudio.com/">R</a> is both a programming language and an interactive environment for data exploration and statistics.</p>
<p>Working with R is primarily text-based. The basic mode of use for R is that the user provides commands in the R language and then R computes and displays the result.</p>
<section id="downloading-installing-and-running-r" class="level3">
<h3 class="anchored" data-anchor-id="downloading-installing-and-running-r">Downloading, Installing and Running R</h3>
<p><strong>Download</strong><br>
R can be downloaded from <a href="https://cran.rstudio.com/index.html">CRAN (The Comprehensive R Archive Network)</a> for Windows, Linux, or Mac.</p>
<p><strong>Install</strong><br>
Installation of R is like most software packages and you will be guided. Should you have any issues or need help you can refer to <a href="https://cran.r-project.org/doc/manuals/r-release/R-admin.html">R Installation and Administration</a></p>
<p><strong>Running</strong><br>
R can be launched from your software or applications launcher or When working at a command line on UNIX or Windows, the command <code>R</code> can be used for starting the main R program in the form <code>R</code></p>
<p>You will see a console similar to this appear:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/console.png" class="img-fluid figure-img" width="414"></p>
</figure>
</div>
</div>
</div>
<p>While it is possible to work solely through the console or using a command line interface, the ideal environment to work in R is RStudio.</p>
</section>
<section id="rstudio" class="level3">
<h3 class="anchored" data-anchor-id="rstudio">RStudio</h3>
<p><a href="https://www.rstudio.com/products/rstudio/download/">RStudio</a> is a user interface for working with R. It is called an Integrated Development Environment (IDE): a piece of software that provides tools to make programming easier. RStudio acts as a sort of wrapper around the R language. You can use R without RStudio, but it’s much more limiting. RStudio makes it easier to import datasets, create and write scripts, and makes using R much more effective. RStudio is also free and open source. To function correctly, RStudio needs R and therefore both need to be installed on your computer. But for this class we’ll be using a browser based version called RStudio Cloud (see directions in the [RStudio Cloud] section below.)</p>
<p>RStudio is divided into four “panes”. The placement of these panes and their content can be customized (see menu, Tools -&gt; Global Options -&gt; Pane Layout).</p>
<p>The Default Layout is:</p>
<ul>
<li>Top Left - <strong>Source</strong>: your scripts and documents</li>
<li>Bottom Left - <strong>Console</strong>: what R would look and be like without RStudio</li>
<li>Top Right - <strong>Environment/History</strong>: look here to see what you have done</li>
<li>Bottom Right - <strong>Files</strong> and more: see the contents of the project/working directory here, like your Script.R file</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/rstudio.png" class="img-fluid figure-img" width="1002"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Posit Cloud
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Posit (RStudio) Cloud is a browser-based version of RStudio. It will allow you to use RStudio without needing to download anything to your computer. You can also easily share your R projects with others. While you will want to download R and RStudio for regular use, we will be using RStudio Cloud for this session so we can all work from the same environment.</p>
<p>Get Started:</p>
<ol type="1">
<li>Create your free RStudio Cloud account at <a href="https://rstudio.cloud/plans/free" class="uri">https://rstudio.cloud/plans/free</a>.</li>
<li>Go to the class project <a href="https://posit.cloud/content/7985464" class="uri">https://posit.cloud/content/7985464</a></li>
<li>Note the text that marks this as a Temporary Copy. Select the <code>Save a Permanent Copy</code> button to begin working!</li>
</ol>
</div>
</div>
</div>
</section>
</section>
<section id="r-scripts" class="level2">
<h2 class="anchored" data-anchor-id="r-scripts">R Scripts</h2>
<p>A script is a document in which you write your code. This makes it easy to re-run that code when you need to. In addition to code, your script can also have comments, which start with a <code>#</code> symbol. These comments make your script more human readable, but are ignored by the computer.</p>
<p>To get started in this lesson - open up the script in your RStudio Project called <code>rwd_lesson.R</code></p>
</section>
<section id="welcome-to-the-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="welcome-to-the-tidyverse">Welcome to the Tidyverse</h2>
<p>As mentioned above, R can be extended in functionality through the use of packages. In this lesson, we will be using a group of packages which are part of what is known as the <strong><code>tidyverse</code></strong> - “an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, developed by Hadley Wickham.</p>
<p>These packages include :</p>
<ul>
<li><strong><code>readr</code></strong> for importing data into R</li>
<li><strong><code>dplyr</code></strong> for handling common data wrangling tasks for tabular data</li>
<li><strong><code>tidyr</code></strong> which enables you to swiftly convert between different data formats (long vs.&nbsp;wide) for plotting and analysis</li>
<li><strong><code>lubridate</code></strong> for working with dates</li>
<li><strong><code>ggplot2</code></strong> for visualizing data (we’ll explore this package in the next chapter).</li>
</ul>
<p>For the full list of tidyverse packages and documentation visit <a href="https://www.tidyverse.org/">tidyverse.org</a> You can install these packages individually, or you can install the entire tidyverse in one go.</p>
<p>While there are <a href="https://cran.r-project.org/web/views/">many R packages available</a>, you will be able to accomplish most common data wrangling and analysis tasks with Base R and the <strong><code>tidyverse</code></strong> packages.</p>
</section>
<section id="what-is-tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="what-is-tidy-data">What is Tidy Data?</h2>
<p>The <strong><code>tidyverse</code></strong> is so named from the concept of “tidy data”. Data is considered “tidy” if it follows three rules:</p>
<ol type="1">
<li>Each column is a variable</li>
<li>Each row is an observation</li>
<li>Each cell is a single value<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
</ol>
<p>Data “in the wild” often isn’t tidy, but the tidyverse packages can help you create and analyze tidy datasets.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/tidy-data.PNG" class="img-fluid figure-img" width="960"></p>
<figcaption>tidy data structure<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="installing-and-loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="installing-and-loading-packages">Installing and loading packages</h2>
<p>When you first install R on your computer, it comes with a set of built-in packages and functions. To add additional packages, you must first install that package, and then load it into your current session. If you are using the <a href="https://posit.cloud/content/7985464">class Posit Cloud project</a>, the <strong><code>tidyverse</code></strong> has already been installed, so we just need to load it. You only need to install a package once on a system, but you will load it each time you start a new r session. If the package had not already been installed, we would install with a function called <code>install.packages()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install tidyverse if you haven't yet</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyverse")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#load tidyverse</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>install.packages()</code> and <code>library()</code> are two examples of <strong>functions</strong>. Functions are one of the most important components of R code. A function is like a canned script. It usually takes some inputs, called <strong>arguments</strong> inside parentheses following the name of the function, performs one or more tasks, and often returns some kind of output. The <code>library()</code> function takes the name of the package to load as it’s argument.</p>
<p>How do you know what arguments a function takes? For that you need to turn to the documentation of a particular package, or from within RStudio you can look up a function with <code>?function-name</code>. Let’s try it with the <code>library()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>?library</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This opens the help pane in the lower right corner of RStudio. The documentation provides you with all the arguments and any default values, along with explanations of the arguments. Here we see that the the library function has the argument package with no defaults.</p>
</section>
<section id="importing-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-data">Importing data</h2>
<p>Now,that the <strong><code>tidyverse</code></strong>is loaded, we can use it to import some data into our RStudio session. We are using a function from the <strong><code>readr</code></strong> package called <code>read_csv()</code>. This function takes as an argument the path to where the file is located. Let’s start by reading in the 2008 beneficiary summary file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">"data/DE1_0_2008_Beneficiary_Summary_File_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 116352 Columns: 32
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (5): DESYNPUF_ID, BENE_ESRD_IND, SP_STATE_CODE, BENE_COUNTY_CD, PLAN_CV...
dbl (27): BENE_BIRTH_DT, BENE_DEATH_DT, BENE_SEX_IDENT_CD, BENE_RACE_CD, BEN...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 116,352 × 32
   DESYNPUF_ID      BENE_BIRTH_DT BENE_DEATH_DT BENE_SEX_IDENT_CD BENE_RACE_CD
   &lt;chr&gt;                    &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;        &lt;dbl&gt;
 1 00013D2EFD8E45D1      19230501            NA                 1            1
 2 00016F745862898F      19430101            NA                 1            1
 3 0001FDD721E223DC      19360901            NA                 2            1
 4 00021CA6FF03E670      19410601            NA                 1            5
 5 00024B3D2352D2D0      19360801            NA                 1            1
 6 0002DAE1C81CC70D      19431001            NA                 1            2
 7 0002F28CE057345B      19220701            NA                 1            1
 8 000308435E3E5B76      19350901            NA                 1            1
 9 000345A39D4157C9      19760901            NA                 2            1
10 00036A21B65B0206      19381001            NA                 2            2
# ℹ 116,342 more rows
# ℹ 27 more variables: BENE_ESRD_IND &lt;chr&gt;, SP_STATE_CODE &lt;chr&gt;,
#   BENE_COUNTY_CD &lt;chr&gt;, BENE_HI_CVRAGE_TOT_MONS &lt;dbl&gt;,
#   BENE_SMI_CVRAGE_TOT_MONS &lt;dbl&gt;, BENE_HMO_CVRAGE_TOT_MONS &lt;dbl&gt;,
#   PLAN_CVRG_MOS_NUM &lt;chr&gt;, SP_ALZHDMTA &lt;dbl&gt;, SP_CHF &lt;dbl&gt;,
#   SP_CHRNKIDN &lt;dbl&gt;, SP_CNCR &lt;dbl&gt;, SP_COPD &lt;dbl&gt;, SP_DEPRESSN &lt;dbl&gt;,
#   SP_DIABETES &lt;dbl&gt;, SP_ISCHMCHT &lt;dbl&gt;, SP_OSTEOPRS &lt;dbl&gt;, SP_RA_OA &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>But doing this just gives us a preview of the data in the console. To really use the data, we need to <strong>assign</strong> it to an <strong>object</strong>. An object is like a container for a numerical value, string, data set, image, and much more. Just about everything in R is an object. You might liken them to variables in other programming languages or in math. We create an object, by giving our data a name and use the <strong>assignment operator</strong>, which looks like an arrow <code>&lt;-</code>. You can manually type in the lesser than sign <code>&lt;</code> and hyphen <code>-</code>, or use the keyboard shortcut <code>Alt + -</code>.</p>
<p>Let’s call our new object <code>bene_2008</code>. Object names should be short and easy to understand. They can’t have spaces, so you’ll want to separate multiple words with a underscore, or by using camel case. Object names also need to start with a letter not a number, and it’s best to avoid using names of common functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>bene_2008 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/DE1_0_2008_Beneficiary_Summary_File_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When you create an object, it shows up in your environment pane (the upper right panel). If we check our environment pane, we should now see an object called <code>bene_2008</code>.</p>
</section>
<section id="exploring-and-summarizing-data" class="level2">
<h2 class="anchored" data-anchor-id="exploring-and-summarizing-data">Exploring and Summarizing data</h2>
<p>After reading the data, you will typically want to start exploring it.</p>
<section id="data-frames" class="level3">
<h3 class="anchored" data-anchor-id="data-frames">Data Frames</h3>
<p>First, it’s important to understand the type of object we just created. In R, tabular data like you find in a spreadsheet is stored in a <strong>data frame</strong>, one of the fundamental <strong>data structures</strong> in R. A data frame is rectangular, two dimensional data. That is, it has both columns and rows. Data frames can store multiple <strong>data types</strong>, such as numeric, character, and logical data. Another common data structure is a <strong>vector</strong>. A vector is a one-dimensional structure. That is, it is simply a sequence of elements. A vector can have only one data type. Data frames are created from multiple vectors, that is, each column in a data frame is a vector. There are several ways of doing this.</p>
</section>
<section id="base-r-functions-for-exploring-data" class="level3">
<h3 class="anchored" data-anchor-id="base-r-functions-for-exploring-data">Base R functions for exploring data</h3>
<p><code>View()</code> opens the data as a file in your documents pane.This is a good way to see the data in a familiar spreadsheet-like format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(bene_2008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>summary()</code> to look at each column and find the data type and interquartile range for numeric data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bene_2008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can look at the beginning of your dataset with <code>head()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bene_2008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DESYNPUF_ID      BENE_BIRTH_DT BENE_DEATH_DT BENE_SEX_IDENT_CD BENE_RACE_CD
  &lt;chr&gt;                    &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;        &lt;dbl&gt;
1 00013D2EFD8E45D1      19230501            NA                 1            1
2 00016F745862898F      19430101            NA                 1            1
3 0001FDD721E223DC      19360901            NA                 2            1
4 00021CA6FF03E670      19410601            NA                 1            5
5 00024B3D2352D2D0      19360801            NA                 1            1
6 0002DAE1C81CC70D      19431001            NA                 1            2
# ℹ 27 more variables: BENE_ESRD_IND &lt;chr&gt;, SP_STATE_CODE &lt;chr&gt;,
#   BENE_COUNTY_CD &lt;chr&gt;, BENE_HI_CVRAGE_TOT_MONS &lt;dbl&gt;,
#   BENE_SMI_CVRAGE_TOT_MONS &lt;dbl&gt;, BENE_HMO_CVRAGE_TOT_MONS &lt;dbl&gt;,
#   PLAN_CVRG_MOS_NUM &lt;chr&gt;, SP_ALZHDMTA &lt;dbl&gt;, SP_CHF &lt;dbl&gt;,
#   SP_CHRNKIDN &lt;dbl&gt;, SP_CNCR &lt;dbl&gt;, SP_COPD &lt;dbl&gt;, SP_DEPRESSN &lt;dbl&gt;,
#   SP_DIABETES &lt;dbl&gt;, SP_ISCHMCHT &lt;dbl&gt;, SP_OSTEOPRS &lt;dbl&gt;, SP_RA_OA &lt;dbl&gt;,
#   SP_STRKETIA &lt;dbl&gt;, MEDREIMB_IP &lt;dbl&gt;, BENRES_IP &lt;dbl&gt;, PPPYMT_IP &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>or the end of your dataset with <code>tail()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(bene_2008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
  DESYNPUF_ID      BENE_BIRTH_DT BENE_DEATH_DT BENE_SEX_IDENT_CD BENE_RACE_CD
  &lt;chr&gt;                    &lt;dbl&gt;         &lt;dbl&gt;             &lt;dbl&gt;        &lt;dbl&gt;
1 FFFD1F9EE7AF231B      19390701            NA                 1            1
2 FFFD7C464C94D136      19430701            NA                 2            1
3 FFFE3ED9582AD46E      19160601            NA                 2            1
4 FFFE7AB5D7F1725D      19390401            NA                 2            1
5 FFFF29A2E1362059      19110701            NA                 1            1
6 FFFF7C107A4E385A      19520401            NA                 2            1
# ℹ 27 more variables: BENE_ESRD_IND &lt;chr&gt;, SP_STATE_CODE &lt;chr&gt;,
#   BENE_COUNTY_CD &lt;chr&gt;, BENE_HI_CVRAGE_TOT_MONS &lt;dbl&gt;,
#   BENE_SMI_CVRAGE_TOT_MONS &lt;dbl&gt;, BENE_HMO_CVRAGE_TOT_MONS &lt;dbl&gt;,
#   PLAN_CVRG_MOS_NUM &lt;chr&gt;, SP_ALZHDMTA &lt;dbl&gt;, SP_CHF &lt;dbl&gt;,
#   SP_CHRNKIDN &lt;dbl&gt;, SP_CNCR &lt;dbl&gt;, SP_COPD &lt;dbl&gt;, SP_DEPRESSN &lt;dbl&gt;,
#   SP_DIABETES &lt;dbl&gt;, SP_ISCHMCHT &lt;dbl&gt;, SP_OSTEOPRS &lt;dbl&gt;, SP_RA_OA &lt;dbl&gt;,
#   SP_STRKETIA &lt;dbl&gt;, MEDREIMB_IP &lt;dbl&gt;, BENRES_IP &lt;dbl&gt;, PPPYMT_IP &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Notice that this prints out the first and last 6 rows of your data frame to the console in what is called a <em>tibble</em>. A tibble is a form of data frame that is particular to the tidyverse. The differences rest mainly it how it reads and displays data, but for the purposes of this class we will use the terms somewhat interchangeably. The tibble printed from <code>head()</code> and <code>tail()</code> will only print as many columns as can fit on the width of your monitor.</p>
<p>Visually, we may find it helpful to look at the distribution of continuous variables in a histogram. To do this, we can use the base function <code>hist()</code>. We’ll learn more about data visualization later in the lesson.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bene_2008<span class="sc">$</span>MEDREIMB_OP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It can also be helpful to know if your data has many missing values. For that you can use the function <code>is.na()</code> or it’s inverse <code>!is.na()</code>. These functions return the logical values <code>TRUE</code> or <code>FALSE</code>. By combining these functions with <code>sum()</code>, we can get the number of missing values, because <code>TRUE</code> = 1 and <code>FALSE</code> = 0 in computer logic. The <code>!</code> operator stands for <code>NOT</code> so <code>!is.na()</code> is looking for values that are NOT missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(bene_2008<span class="sc">$</span>BENE_DEATH_DT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 114538</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(bene_2008<span class="sc">$</span>BENE_DEATH_DT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1814</code></pre>
</div>
</div>
</section>
<section id="tidyverse-functions-for-exploring-data" class="level3">
<h3 class="anchored" data-anchor-id="tidyverse-functions-for-exploring-data"><strong><code>tidyverse</code></strong> functions for exploring data</h3>
<p>The <code>glimpse()</code> function which is part of the <strong><code>tidyverse</code></strong> package <strong><code>tibble</code></strong>, lets you see the column names and data types clearly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(bene_2008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>distinct()</code> returns the distinct rows in a data frame. It can be used on a column to return the distinct values in that column. For our DE-SynPUF data, we can get this information from the codebook, but for less well-documented data, this is a highly useful function. The first argument you supply is the data frame object. Subsequent arguments include the variables you want to count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(bene_2008, BENE_RACE_CD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 1
  BENE_RACE_CD
         &lt;dbl&gt;
1            1
2            5
3            2
4            3</code></pre>
</div>
</div>
<p><code>count()</code> is similar to <code>distinct()</code> but also returns the number of observations (i.e.&nbsp;rows) for each of those distinct values. The first argument you supply is the data frame object. Subsequent arguments include the variables you want to count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">count</span>(bene_2008, BENE_SEX_IDENT_CD) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  BENE_SEX_IDENT_CD     n
              &lt;dbl&gt; &lt;int&gt;
1                 1 52005
2                 2 64347</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Make code flow with the pipe %>%">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Make code flow with the pipe %&gt;%
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before we go any further - I want to introduce you to an important time-saving symbol in R called the pipe <code>%&gt;%</code> (<code>CTRL + SHIFT + M</code>). The pipe allows you to take the output of the left-hand expression and make it the input of the right-hand expression. It allows you to chain together multiple functions and avoid nesting. With the pipe, we can rewrite the above code as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bene_2008 <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(BENE_SEX_IDENT_CD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  BENE_SEX_IDENT_CD     n
              &lt;dbl&gt; &lt;int&gt;
1                 1 52005
2                 2 64347</code></pre>
</div>
</div>
<p>In many tidyverse functions, the first argument is the name of the data frame you’re applying the function to. So when you use the pipe, you’ll generally start a line of code with the name of a data frame. One benefit you might notice right away, is that when we use the pipe, RStudio will supply the column names which helps to reduce typing and typos.</p>
</div>
</div>
<p>Let’s try count again, this time with two variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bene_2008 <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(BENE_SEX_IDENT_CD, BENE_RACE_CD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  BENE_SEX_IDENT_CD BENE_RACE_CD     n
              &lt;dbl&gt;        &lt;dbl&gt; &lt;int&gt;
1                 1            1 43058
2                 1            2  5408
3                 1            3  2282
4                 1            5  1257
5                 2            1 53291
6                 2            2  6935
7                 2            3  2649
8                 2            5  1472</code></pre>
</div>
</div>
<p>Now we get counts of the combinations of those two categories.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="CHALLENGE">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
CHALLENGE
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>How many people in the data frame have congestive heart failure (CHF)?</li>
<li>How many people of each race have congestive heart failure?</li>
</ol>
</div>
</div>
</section>
</section>
<section id="subsetting-data-with-select-and-filter" class="level2">
<h2 class="anchored" data-anchor-id="subsetting-data-with-select-and-filter">Subsetting data with <code>select()</code> and <code>filter()</code></h2>
<p>A real world data set could have hundreds of columns and millions of rows. So, once you’ve explored your data, you may want to start trimming it down to just the variables and conditions you’re interested in. In this section, we’ll look at two functions from the <strong><code>tidyverse</code></strong> package called <strong><code>dplyr</code></strong>: <code>select()</code> which lets you choose columns (variables) and <code>filter()</code> which lets you choose rows. (Note: <code>dplyr</code> is known for using easy to understand verbs for its function names.)</p>
<p>Let’s start by filtering our data frame to include only those with CHF. We’ll assign the resulting data frame to a new object</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>bene_CHF <span class="ot">&lt;-</span> bene_2008 <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SP_CHF<span class="sc">==</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>filter()</code> takes the name of the data frame and one or more logical conditions as arguments. Here we are saying keep all the rows where the value in the <code>SP_CHF</code> column is 1. Note the use of the double equals sign == versus the singular = sign. The double equal sign is a <strong>logical operator</strong>. The logical operators are:</p>
<table class="table">
<thead>
<tr class="header">
<th>operator</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>==</td>
<td>exactly equal</td>
</tr>
<tr class="even">
<td>!=</td>
<td>not equal to</td>
</tr>
<tr class="odd">
<td>&lt;</td>
<td>less than</td>
</tr>
<tr class="even">
<td>&lt;=</td>
<td>less than or equal to</td>
</tr>
<tr class="odd">
<td>&gt;</td>
<td>greater than</td>
</tr>
<tr class="even">
<td>&gt;=</td>
<td>greater than or equal to</td>
</tr>
<tr class="odd">
<td>x|y</td>
<td>x or y</td>
</tr>
<tr class="even">
<td>x&amp;y</td>
<td>x and y</td>
</tr>
<tr class="odd">
<td>!x</td>
<td>not x</td>
</tr>
</tbody>
</table>
<p>Note that after running our code, our resulting data frame (our new object <code>bene_CHF</code>) has 33155 observations (rows) while our original data frame had 116352.</p>
<p>We can use <code>filter()</code> together with <code>count()</code>. For example, if we want to know how many women with CHF are in our dataframe we can write</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>bene_2008 <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SP_CHF <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> BENE_SEX_IDENT_CD <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1 19046</code></pre>
</div>
</div>
<p>Here, we joined together 2 conditions with the <code>&amp;</code> logical operator. Then we <strong>piped</strong> that resulting data frame to <code>count()</code> which remember takes a data frame as its first argument.</p>
<p>Let’s try figuring out in how many rows of our dataset, the inpatient annual Medicare reimbursement amount is more than 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bene_2008 <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MEDREIMB_IP <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1 15422</code></pre>
</div>
</div>
<p>Note that without the pipe operator, we’d either have to nest our functions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(<span class="fu">filter</span>(bene_2008, MEDREIMB_IP <span class="sc">&gt;</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1 15422</code></pre>
</div>
</div>
<p>With more complicated code, that could quickly become difficult to read. Or, we’d have to save a lot of intermediary objects that we don’t really need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>bene_filter <span class="ot">&lt;-</span> <span class="fu">filter</span>(bene_2008, MEDREIMB_IP <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>bene_count <span class="ot">&lt;-</span> <span class="fu">count</span>(bene_filter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s keep working with our <code>bene_CHF</code> object, and get rid of unneeded variables. We’ll still save our new, smaller data frame to a new object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bene_CHF_select <span class="ot">&lt;-</span> bene_CHF <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DESYNPUF_ID,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>         BENE_BIRTH_DT,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         BENE_SEX_IDENT_CD,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>         BENE_RACE_CD,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>         SP_STATE_CODE,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>         MEDREIMB_IP,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>         MEDREIMB_OP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you look in the environment pane, you’ll see our new object has just 7 variables (columns), compared to our original 32 columns, but the same number of observations (rows) as <code>bene_CHF</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="CHALLENGE">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
CHALLENGE
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Using <code>count()</code>, find out how many people of each race and sex are present in our <code>bene_CHF_select</code> data frame</li>
<li>Using <code>filter()</code>, on <code>bene_2008</code> create a data frame which includes only people in Maryland with end stage renal disease</li>
<li>Use <code>select()</code> and <code>filter()</code> to create a data frame with variables that interest you.</li>
</ol>
</div>
</div>
</section>
<section id="changing-and-creating-variables-with-mutate" class="level2">
<h2 class="anchored" data-anchor-id="changing-and-creating-variables-with-mutate">Changing and creating variables with <code>mutate()</code></h2>
<p>Let’s remind ourselves about the columns present in our <code>bene_CHF_select</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bene_CHF_select)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> DESYNPUF_ID        BENE_BIRTH_DT      BENE_SEX_IDENT_CD  BENE_RACE_CD  
 Length:33155       Min.   :19090101   Min.   :1.000     Min.   :1.000  
 Class :character   1st Qu.:19261101   1st Qu.:1.000     1st Qu.:1.000  
 Mode  :character   Median :19340701   Median :2.000     Median :1.000  
                    Mean   :19350312   Mean   :1.574     Mean   :1.246  
                    3rd Qu.:19410701   3rd Qu.:2.000     3rd Qu.:1.000  
                    Max.   :19831201   Max.   :2.000     Max.   :5.000  
 SP_STATE_CODE       MEDREIMB_IP      MEDREIMB_OP   
 Length:33155       Min.   : -3000   Min.   :  -80  
 Class :character   1st Qu.:     0   1st Qu.:   70  
 Mode  :character   Median :     0   Median :  490  
                    Mean   :  6409   Mean   : 1341  
                    3rd Qu.:  7000   3rd Qu.: 1450  
                    Max.   :164220   Max.   :50020  </code></pre>
</div>
</div>
<p>You might notice here something a little funny going on. The columns <code>BENE_BIRTH_DT</code>, <code>BENE_SEX_IDENT_CD</code>, <code>BENE_RACE_CD</code> are being treated as numeric. The summary function is attempting to calculate interquartile ranges for these variables. The race and sex variables are coded. So even though the values are 1 and 2, we want to treat them as categorical variables, not numeric.</p>
<p>Let’s start by changing the the <code>BENE_BIRTH_DT</code> to a formatted date. This will allow us to do calculations like determining age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bene_mutate <span class="ot">&lt;-</span> bene_CHF_select <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BENE_BIRTH_DT =</span> <span class="fu">ymd</span>(BENE_BIRTH_DT))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bene_mutate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> DESYNPUF_ID        BENE_BIRTH_DT        BENE_SEX_IDENT_CD  BENE_RACE_CD  
 Length:33155       Min.   :1909-01-01   Min.   :1.000     Min.   :1.000  
 Class :character   1st Qu.:1926-11-01   1st Qu.:1.000     1st Qu.:1.000  
 Mode  :character   Median :1934-07-01   Median :2.000     Median :1.000  
                    Mean   :1935-06-05   Mean   :1.574     Mean   :1.246  
                    3rd Qu.:1941-07-01   3rd Qu.:2.000     3rd Qu.:1.000  
                    Max.   :1983-12-01   Max.   :2.000     Max.   :5.000  
 SP_STATE_CODE       MEDREIMB_IP      MEDREIMB_OP   
 Length:33155       Min.   : -3000   Min.   :  -80  
 Class :character   1st Qu.:     0   1st Qu.:   70  
 Mode  :character   Median :     0   Median :  490  
                    Mean   :  6409   Mean   : 1341  
                    3rd Qu.:  7000   3rd Qu.: 1450  
                    Max.   :164220   Max.   :50020  </code></pre>
</div>
</div>
<p><code>mutate()</code> takes as an argument the name and definition of the new column you’re creating. You can create multiple new columns at a time, separating each new variable name and definition with a comma. Note that if you use the same variable name as an existing variable name it overwrites that column. Otherwise, it will add a column to your data frame.</p>
<p>To change the variable to a date - we are using a date parsing function from another package called <strong><code>lubridate</code></strong>. <code>ymd()</code> takes a a character string or number in year-month-day format and returns a formal date object in YYYY-MM-DD format. There are similar functions if the input date is in month-day-year <code>mdy()</code> or day-month-year <code>dmy()</code></p>
<p>Now, that <code>BENE_BIRTH_DT</code> is an actual date, we can use it to create an age variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>bene_mutate <span class="ot">&lt;-</span> bene_mutate <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="dv">2008</span> <span class="sc">-</span> <span class="fu">year</span>(BENE_BIRTH_DT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s turn our attention to the BENE_RACE_CD and BENE_SEX_IDENT_CD. These are categorical variables. To store categorical variables, R uses a special data type called a <strong>factor</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>bene_mutate <span class="ot">&lt;-</span> bene_mutate <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="dv">2008</span> <span class="sc">-</span> <span class="fu">year</span>(BENE_BIRTH_DT),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">BENE_RACE_CD =</span> <span class="fu">as.factor</span>(BENE_RACE_CD),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">BENE_SEX_IDENT_CD =</span> <span class="fu">as.factor</span>(BENE_SEX_IDENT_CD))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>R has several functions used for coercing one data type to another such as <code>as.character()</code> and <code>as.numeric()</code>.</p>
</section>
<section id="grouping-and-summarizing" class="level2">
<h2 class="anchored" data-anchor-id="grouping-and-summarizing">Grouping and Summarizing</h2>
<p>The next step you might want to do in your data analysis is to compare different groups in your study. We can do this with <strong><code>dplyr</code></strong> functions <code>group_by()</code> and <code>summarize()</code>. First let’s group our data by race:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>bene_one_group <span class="ot">&lt;-</span> bene_mutate <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(BENE_RACE_CD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we run our code, you might notice that apparently not much has changed. <code>group_by()</code> is a preparatory step for other actions. Let’s look at the average in patient reimbursement by race in our data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>bene_one_group <span class="ot">&lt;-</span> bene_mutate <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(BENE_RACE_CD) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_ip_reimb =</span> <span class="fu">mean</span>(MEDREIMB_IP))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could add another grouping variable to <code>group_by()</code> and another summarized variable to summarize</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="ot">&lt;-</span> bene_mutate <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(BENE_RACE_CD, BENE_SEX_IDENT_CD) <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_ip_reimb =</span> <span class="fu">mean</span>(MEDREIMB_IP),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_op_reimb =</span> <span class="fu">mean</span>(MEDREIMB_OP),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'BENE_RACE_CD'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
</section>
<section id="visualizing-data-with-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-data-with-ggplot2">Visualizing Data with ggplot2</h2>
<p>Next, we will learn about <strong><code>ggplot2</code></strong> - a tidyverse package for visualizing data. It is a powerful and flexible tool that allows you to create fully customizable, publication quality graphics. The gg in <strong><code>ggplot2</code></strong> stands for grammar of graphics. The grammar of graphics is the underlying philosophy of the package. It focuses on creating graphics in layers. Start with the data – map the data the axes and to aesthetic qualities like size, shape, and color and geometries like dots, lines, and polygons. Further refine the appearance of your plot by adjusting scales and legends, labels, coordinate systems, and adding annotations.</p>
<p>All <code>ggplot2</code> graphs start with the same basic template:</p>
<pre><code>&lt;DATA&gt; %&gt;%
    ggplot(aes(&lt;MAPPINGS&gt;)) +
    &lt;GEOM_FUNCTION&gt;() +
    &lt;Additional GEOMS, SCALES, THEMES, etc. . . &gt;
</code></pre>
<p>All graphs start with the ggplot function and the data. We’ll use the pipe to pipe the data to the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>bene_mutate <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see that even this initializes the plot area of RStudio.</p>
<p>Next, we define a mapping (using the aesthetic, or <code>aes()</code>, function), by selecting the variables to be plotted and specifying how to present them in the graph, e.g.&nbsp;as x/y positions or characteristics such as size, shape, color, etc. Here we will say that the x axis should contain the affiliation variable. Note how the x-axis populates with some numbers and tick marks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>bene_mutate <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next we need to add <code>‘geoms’</code> – graphical representations of the data in the plot (points, lines, bars). <strong><code>ggplot2</code></strong> offers many different geoms for common graph types. To add a geom to the plot use the <code>+</code> operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>bene_mutate <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD)) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you want the y axis to display something other than count, you need to make a couple of small adjustments. First - specify the <code>y</code> variable in the <code>aes()</code> function, and change the stat argument from it’s default of “count” to “identity” This tells it to base the y axis on the specified variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>bene_one_group <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb)) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="setting-vs-mapping-aesthetics" class="level3">
<h3 class="anchored" data-anchor-id="setting-vs-mapping-aesthetics">Setting vs mapping aesthetics</h3>
<p>When working with <strong><code>ggplot2</code></strong>, it’s important to understand the difference between <em>setting</em> aesthetic properties and <em>mapping</em> them. All geoms have certain visual attributes that can be modified. Polygons like bars, have the properties fill and color. You can change the inside color of a bar with <code>fill</code>, and the border with <code>color</code>. We can modify the defaults with the <code>fill</code> and <code>color</code> arguments in the <code>geom_bar()</code> layer. (I’ve also increased the <code>linewidth</code> to make it easier to see the border color)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>bene_one_group <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb)) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill=</span><span class="st">"blue"</span>, </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color=</span><span class="st">"purple"</span>, </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">linewidth=</span><span class="fl">1.5</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>How did we know the color names “blue” and “purple” would work in the code above? R has 657 (!!) built in color names. You can see them by calling the function <code>colors()</code>. You can also specify colors using rgb and hexadecimal codes.</p>
</div>
</div>
<p>Now we have manually set a value for the fill and color. To create our initial graph, we used the <code>mapping</code> argument and the <code>aes()</code> function to map the x axis to the <code>BENE_RACE_CD</code> variable. Watch what happens if we map the fill property to the <code>BENE_RACE_CD</code> variable as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>bene_one_group <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_RACE_CD)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="building-a-grouped-bar-chart" class="level3">
<h3 class="anchored" data-anchor-id="building-a-grouped-bar-chart">Building a grouped bar chart</h3>
<p>Mapping a variable to an aesthetic is especially useful when we have third variable we want to express on our graph. For example, what if we want to compare mean inpatient reimbursement by both race and sex? To do this we can create a grouped bar chart by mapping <code>fill</code> to the <code>BENE_SEX_IDENT_CD</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_SEX_IDENT_CD)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you map an aesthetic with <code>aes()</code> in the <code>ggplot()</code> function it is inherited by all subsequent layers. When you map in a <code>geom_*()</code> function it is applied only to that layer.</p>
</div>
</div>
<p>BY default this creates a stacked bar chart. To make it grouped, we add a <code>position="dodged"</code> argument to <code>geom_bar()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_SEX_IDENT_CD)) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To make our graph look less crowded, we can also modify the width of the bars. Note this is done outside of the <code>aes()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_SEX_IDENT_CD)) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width=</span><span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adding-titles-and-axis-labels" class="level3">
<h3 class="anchored" data-anchor-id="adding-titles-and-axis-labels">Adding titles and axis labels</h3>
<p>A good plot communicates clearly. So far we’ve talked about achieving this through the aesthetic aspects of your plot, but it’s important to make sure your graph has a clear title and axis labels as well. There are a few ways to do this in <strong><code>ggplot2</code></strong>, but one of the simplest is to use the <code>labs()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_SEX_IDENT_CD)) <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width=</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean Inpatient annual Medicare reimbursement amount </span><span class="sc">\n</span><span class="st"> for patients with CHF"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"By Race and Sex"</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Race"</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean reimbursement amount"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also change the labels of the tick marks and the legend with the <code>scale_*</code> family of functions. Choose the right function by looking for the one with the appropriate axis and data type. This function has a <code>labels =</code> argument that takes a character vector of label names. So we’ll choose</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_SEX_IDENT_CD)) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width=</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean Inpatient annual Medicare reimbursement amount </span><span class="sc">\n</span><span class="st"> for patients with CHF"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"By Race and Sex"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Race"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean reimbursement amount"</span>) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Others"</span>, <span class="st">"Hispanic"</span>)) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Sex"</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="working-with-color-palettes" class="level3">
<h3 class="anchored" data-anchor-id="working-with-color-palettes">Working with color palettes</h3>
<p>While <strong><code>ggplot</code></strong> comes with a default color palette, there are numerous other palettes out there you can use, such as:</p>
<ul>
<li><a href="https://r-graph-gallery.com/38-rcolorbrewers-palettes.html"><strong><code>RColorBrewer</code></strong></a></li>
<li><a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html"><strong><code>viridis</code></strong></a></li>
<li><a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/"><strong><code>ggthemes</code></strong></a></li>
<li><a href="https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html"><strong><code>ggsci</code></strong></a></li>
<li><a href="https://github.com/karthik/wesanderson#readme"><strong><code>wesanderson</code></strong></a></li>
</ul>
<p>Let’s try applying a viridis palette. viridis was designed to be especially robust for many forms of color-blindness. It is also meant to print well in grey scale. As an additional advantage, a lightweight form of the package is included with ggplot2, so there is no need to install additional packages.</p>
<p>To do this, we need to change our function <code>scale_fill_discrete()</code> to <code>scale_viridis_d()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_SEX_IDENT_CD)) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width=</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean Inpatient annual Medicare reimbursement amount </span><span class="sc">\n</span><span class="st"> for patients with CHF"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"By Race and Sex"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Race"</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean reimbursement amount"</span>) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Others"</span>, <span class="st">"Hispanic"</span>)) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="st">"Sex"</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Learn more from the <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html#the-color-scales"><strong><code>viridis</code></strong> documentation</a></p>
</section>
<section id="changing-the-theme" class="level3">
<h3 class="anchored" data-anchor-id="changing-the-theme">Changing the theme</h3>
<p>The theme of a <strong><code>ggplot2</code></strong> graph controls the overall look and all non-data elements of the plot. There are several built-in themes which can be applied as another layer. Start typing <code>theme_</code> in RStudio to see a list of themes. You can also use the <code>theme()</code> function to modify aspects of an existing theme. Here we apply <code>theme_classic()</code> which removes the grid lines and grey background of the default theme.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bene_two_groups <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>BENE_RACE_CD, <span class="at">y=</span>mean_ip_reimb, <span class="at">fill=</span>BENE_SEX_IDENT_CD)) <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width=</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean Inpatient annual Medicare reimbursement amount </span><span class="sc">\n</span><span class="st"> for patients with CHF"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"By Race and Sex"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Race"</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean reimbursement amount"</span>) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Others"</span>, <span class="st">"Hispanic"</span>)) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="st">"Sex"</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01-RBasics_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="joining-datasets" class="level2">
<h2 class="anchored" data-anchor-id="joining-datasets">Joining datasets</h2>
<p>DE-SynPUF data is divided into multiple tables, and so far we’ve only worked with one. All the tables are linked by a variable called <code>DESYNPUF_ID</code>. This variable allows a researcher to track an individual through the different files. In this lesson, we’ll learn how to join these files so you can combine demographic data with clinical data about visits and prescription drugs use.</p>
<p>One way of combining tables is through concatenation. This would be appropriate for the three beneficiary summary files which each contain the same variables, but for different years.</p>
<p>First, we need to import the remaining two summary files. Let’s also import the inpatient sample file. We’ll work with that next.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>bene_2009 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/DE1_0_2009_Beneficiary_Summary_File_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 114538 Columns: 32
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (5): DESYNPUF_ID, BENE_ESRD_IND, SP_STATE_CODE, BENE_COUNTY_CD, PLAN_CV...
dbl (27): BENE_BIRTH_DT, BENE_DEATH_DT, BENE_SEX_IDENT_CD, BENE_RACE_CD, BEN...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>bene_2010 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/DE1_0_2010_Beneficiary_Summary_File_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 112754 Columns: 32
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (5): DESYNPUF_ID, BENE_ESRD_IND, SP_STATE_CODE, BENE_COUNTY_CD, PLAN_CV...
dbl (27): BENE_BIRTH_DT, BENE_DEATH_DT, BENE_SEX_IDENT_CD, BENE_RACE_CD, BEN...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>bene_ip <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/DE1_0_2008_to_2010_Inpatient_Claims_Sample_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 66773 Columns: 81
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (23): DESYNPUF_ID, PRVDR_NUM, AT_PHYSN_NPI, OP_PHYSN_NPI, OT_PHYSN_NPI, ...
dbl (13): CLM_ID, SEGMENT, CLM_FROM_DT, CLM_THRU_DT, CLM_PMT_AMT, NCH_PRMRY_...
lgl (45): HCPCS_CD_1, HCPCS_CD_2, HCPCS_CD_3, HCPCS_CD_4, HCPCS_CD_5, HCPCS_...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>To concatenate files, we use the function <code>bind_rows()</code>. This takes the names of data frames we want to join as arguments. There is also an optional argument <code>.id=</code> which creates a column to identify which data frame the row came from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>bene_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(bene_2008, bene_2009, bene_2010, <span class="at">.id =</span> <span class="st">"File"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To combine a summary file with a file like the inpatient sample, we would use a <strong>join</strong> to match rows based on the <code>DESYNPUF_ID</code>. There are different join functions available, based on what you are trying to accomplish. These terms may be familiar if you’ve ever worked with SQL and relational databases:</p>
<ul>
<li>An <code>inner_join()</code>: keeps only the observations from data frame <code>x</code> that have a matching key in data frame <code>y</code></li>
<li>A <code>left_join()</code> keeps all observations in <code>x</code>.</li>
<li>A <code>right_join()</code> keeps all observations in <code>y</code>.</li>
<li>A <code>full_join()</code> keeps all observations in <code>x</code> and <code>y</code>.</li>
</ul>
<p>Here, we will use an inner join, and keep only the observations (rows) from the 2010 beneficiary summary that are present in the inpatient sample file. That is, if a beneficiary did not file any inpatient claims, they would not be present in our resulting table.</p>
<p>Let’s first trim our <code>bene_2010</code> data frame to just a few variables, and then use the <code>inner_join()</code> function to link it to the <code>bene_ip</code> data frame. We’ll use the <code>by =</code> argument to name the variable (column) to join on. The name of the variable must be a string in this argument (indicated by putting it in quotes).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>bene_ip_join <span class="ot">&lt;-</span> bene_2010 <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SP_CHF <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DESYNPUF_ID, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>         BENE_BIRTH_DT, </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>         BENE_DEATH_DT, </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>         BENE_SEX_IDENT_CD, </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>         BENE_RACE_CD) <span class="sc">%&gt;%</span> </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(bene_ip, <span class="at">by =</span> <span class="st">"DESYNPUF_ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="next-steps-from-beginnr-to-practitionr" class="level2">
<h2 class="anchored" data-anchor-id="next-steps-from-beginnr-to-practitionr">Next Steps: From BeginnR to PractitionR</h2>
<p>I hope you enjoyed this very brief introduction to R. You may be wondering - where do you go from here?</p>
<p>There are tons of R classes and tutorials on the internet, but the best way to learn R is to use it! I recommend picking a data set and just playing around. There’s no harm in making mistakes along the way. It’s much easier to find a useful tutorial if you look for ones that teach a specific task you want to accomplish.</p>
<p>Also, check out these helpful resources:</p>
<ol type="1">
<li><a href="https://r4ds.hadley.nz/">R for Data Science</a>, by Hadley Wickham</li>
<li><a href="https://www.tidyverse.org/">Tidyverse documentation</a></li>
<li><a href="https://r-graph-gallery.com/">R Graph Gallery</a></li>
<li><a href="https://r-graphics.org/">R Graphics Cookbook</a></li>
</ol>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://www.tidyverse.org/<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>read more about tidy data https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>image from R for Data Science https://r4ds.had.co.nz/tidy-data.html#fig:tidy-structure<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>